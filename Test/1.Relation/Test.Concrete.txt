using System;
using System.Collections.Generic;
using System.Linq;
using System.Runtime.InteropServices;
using System.Text;
using CSharpLogic;
using NUnit.Framework;

namespace AlgebraGeometry
{
    [TestFixture]
    public class TestRelation_Concrete
    {
        #region CRUD Input

        [Test]
        public void Test_LineSegment_CRUD_1()
        {
            /*
             * Input sequence:
             * 1: (AB) [LineSegment]  => LineSegment
             * 2: A(2,3)          => Point
             * 3: B(3,4)          => Point
             * Update: AB [Label] => LineSegment
             */
            var graph = new RelationGraph();
            var lineSeg = new LineSegment("AB");
            //Assert.True(lineSeg.RelationStatus);
            graph.AddNode(lineSeg); //api call
            Assert.True(graph.Nodes.Count == 1);

            var A = new Point("A", 2, 3);
            graph.AddNode(A); //api call
            Assert.True(graph.Nodes.Count == 2);

            List<ShapeNode> nodes = graph.RetrieveShapeNodes(ShapeType.LineSegment);
            Assert.True(nodes.Count == 1);
            Assert.True(nodes[0].InEdges.Count == 1);
            Assert.True(nodes[0].OutEdges.Count == 0);

            nodes = graph.RetrieveShapeNodes(ShapeType.Point);
            Assert.True(nodes.Count == 1);
            Assert.True(nodes[0].InEdges.Count == 0);
            Assert.True(nodes[0].OutEdges.Count == 1);

            var B = new Point("B", 3, 4);
            graph.AddNode(B); //api call
            Assert.True(graph.Nodes.Count == 3);

            nodes = graph.RetrieveShapeNodes(ShapeType.LineSegment);
            Assert.True(nodes.Count == 1);
            Assert.True(nodes[0].InEdges.Count == 2);
            Assert.True(nodes[0].OutEdges.Count == 0);

            var lineObj = nodes[0].Shape as LineSegment;
            Assert.NotNull(lineObj);
            Assert.True(lineObj.Label.Equals("AB"));
            Assert.NotNull(lineObj.Pt1);
            Assert.True(lineObj.Pt1.Equals(A));
            Assert.NotNull(lineObj.Pt2);
            Assert.True(lineObj.Pt2.Equals(B));
            //Assert.True(lineObj.RelationStatus);
            Assert.True(lineObj.CachedSymbols.Count == 1);
        }

        [Test]
        public void Test_LineSegment_CRUD_2()
        {
            /*
            * Input sequence:
            * 1: (AB) [LineSegment]  => LineSegment
            * 2: A(2,3)          => Point
            * 3: B(2,3)          => Point
            * Update: AB [Label] => LineSegment
            */
            var graph = new RelationGraph();
            var lineSeg = new LineSegment("AB");
            //Assert.True(lineSeg.RelationStatus);
            graph.AddNode(lineSeg); //api call
            Assert.True(graph.Nodes.Count == 1);

            var A = new Point("A", 2, 3);
            graph.AddNode(A); //api call
            Assert.True(graph.Nodes.Count == 2);

            List<ShapeNode> nodes = graph.RetrieveShapeNodes(ShapeType.LineSegment);
            Assert.True(nodes.Count == 1);
            Assert.True(nodes[0].InEdges.Count == 1);
            Assert.True(nodes[0].OutEdges.Count == 0);

            nodes = graph.RetrieveShapeNodes(ShapeType.Point);
            Assert.True(nodes.Count == 1);
            Assert.True(nodes[0].InEdges.Count == 0);
            Assert.True(nodes[0].OutEdges.Count == 1);

            var B = new Point("B", 2, 3);
            graph.AddNode(B); //api call
            Assert.True(graph.Nodes.Count == 3);

            nodes = graph.RetrieveShapeNodes(ShapeType.LineSegment);
            Assert.True(nodes.Count == 1);
            Assert.True(nodes[0].InEdges.Count == 2);
            Assert.True(nodes[0].OutEdges.Count == 0);

            var lineObj = nodes[0].Shape as LineSegment;
            Assert.NotNull(lineObj);
            Assert.True(lineObj.Label.Equals("AB"));
            //Assert.True(lineObj.RelationStatus);
            Assert.True(lineObj.CachedSymbols.Count == 0);
        }

        #endregion
    }
}